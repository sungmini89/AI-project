# 스마트 영수증 분할 계산기 - PRD (Product Requirements Document)

## 문서 정보
- **작성일**: 2024-01-15
- **작성자**: Development Team
- **버전**: 1.0
- **승인자**: Product Manager
- **최종 업데이트**: 2024-01-15

---

## 1. 기능 요구사항 (Functional Requirements)

### 1.1 핵심 기능

#### 1.1.1 영수증 OCR 기능
- **요구사항**: 사용자가 업로드한 영수증 이미지에서 텍스트 정보를 자동 추출
- **세부 기능**:
  - 이미지 업로드 (드래그 앤 드롭, 파일 선택)
  - 지원 형식: JPG, PNG, WEBP (최대 10MB)
  - Tesseract.js 엔진을 활용한 한국어/영어 OCR 처리
  - 다중 스케일 처리로 인식률 향상 (1.2x~2.5x)
  - 이미지 대비 강화 전처리
- **입력**: 영수증 이미지 파일
- **출력**: 상품명, 가격, 총액이 포함된 구조화된 데이터
- **성공 조건**: OCR 정확도 80% 이상, 처리 시간 10초 이내

#### 1.1.2 AI 기반 데이터 검증 (선택사항)
- **요구사항**: Google Gemini API를 활용한 OCR 결과 개선
- **세부 기능**:
  - OCR 결과 검증 및 오류 수정
  - 누락된 항목 보완
  - 일일 60회 API 호출 제한 관리
  - 속도 제한 및 사용량 추적
- **조건**: API 키 설정 시에만 활성화 (optional)

#### 1.1.3 수동 편집 기능
- **요구사항**: OCR 결과를 사용자가 직접 수정 가능
- **세부 기능**:
  - 항목명, 가격, 수량 개별 편집
  - 항목 추가/삭제
  - 실시간 총액 계산
  - 변경사항 저장
- **접근성**: 키보드 네비게이션 완전 지원

#### 1.1.4 참가자 관리
- **요구사항**: 정산에 참여할 사람들을 관리
- **세부 기능**:
  - 참가자 추가/삭제/수정
  - 참가자별 고유 색상 자동 할당
  - 이름 중복 검사
  - 최대 20명까지 지원
- **검증**: 참가자 이름 필수 입력

#### 1.1.5 항목별 할당 기능
- **요구사항**: 각 항목을 참가자에게 할당
- **세부 기능**:
  - 다중 선택 가능 (한 항목을 여러 명이 나눠 계산)
  - 토글 방식 참가자 선택
  - 실시간 할당 현황 시각화
  - 미할당 항목 경고 표시
- **계산 방식**: 항목별 균등분할

#### 1.1.6 정산 계산 엔진
- **요구사항**: 할당된 항목을 기반으로 참가자별 금액 계산
- **계산 로직**:
  ```
  참가자별 금액 = Σ(할당받은 항목의 (가격 × 수량) / 해당 항목 할당 인원)
  ```
- **출력**: 참가자별 지불 금액, 항목별 세부 내역
- **정확성**: 원 단위까지 정확한 계산

### 1.2 부가 기능

#### 1.2.1 히스토리 관리
- **요구사항**: 계산 결과를 저장하고 관리
- **저장 데이터**: 계산명, 날짜, 총액, 참가자 수, 항목 수, 정산 상태
- **상태 관리**: 대기중(🟡), 공유됨(🔵), 완료(🟢)
- **기능**: 검색, 필터링, 삭제, 상세보기

#### 1.2.2 결과 공유
- **요구사항**: 계산 결과를 다른 참가자와 공유
- **방식**: URL 링크 생성, 텍스트 복사
- **포함 정보**: 참가자별 금액, 항목별 세부 내역

## 2. 비기능 요구사항 (Non-Functional Requirements)

### 2.1 성능 요구사항
- **로딩 속도**: 
  - First Contentful Paint < 1.5초
  - Largest Contentful Paint < 2.5초
  - Time to Interactive < 3초
- **OCR 처리**: 10초 이내 완료
- **반응 속도**: 사용자 입력에 100ms 이내 반응
- **메모리 사용량**: 모바일에서 100MB 이하

### 2.2 확장성 요구사항
- **동시 사용자**: 1,000명까지 안정적 서비스
- **데이터 처리**: 영수증 이미지 10MB, 항목 100개까지
- **브라우저 호환성**: Chrome 90+, Firefox 88+, Safari 14+, Edge 90+

### 2.3 신뢰성 요구사항
- **가용성**: 99.9% 업타임
- **데이터 무결성**: 계산 결과 정확도 100%
- **오류 복구**: 네트워크 오류 시 자동 재시도
- **데이터 백업**: localStorage 기반 로컬 저장

### 2.4 보안 요구사항
- **데이터 처리**: 모든 처리를 클라이언트 측에서 수행
- **개인정보 보호**: 서버로 영수증 이미지 전송 없음
- **API 보안**: Gemini API 키 안전한 관리
- **XSS 방지**: 입력 데이터 검증 및 이스케이프

### 2.5 사용성 요구사항
- **접근성**: WCAG 2.1 AA 준수
- **반응형**: 모바일, 태블릿, 데스크톱 지원
- **다국어**: 한국어 우선, 영어 지원 고려
- **오프라인**: PWA 기반 오프라인 사용 가능

## 3. 페이지/화면 구성

### 3.1 메인 계산기 페이지 (`/`)
- **목적**: 영수증 분할 계산의 전체 워크플로우
- **구성요소**:
  - 진행 단계 인디케이터 (항목 입력 → 참가자 할당 → 계산 결과)
  - 입력 방법 선택 탭 (영수증 촬영 / 직접 입력)
  - 영수증 업로더 컴포넌트
  - OCR 분석 진행률 표시
  - 분석 결과 편집 인터페이스
- **상태 관리**: 3단계 스텝 워크플로우

### 3.2 편집 페이지 (`/edit`)
- **목적**: OCR 결과 상세 편집
- **구성요소**:
  - 원본 영수증 이미지 미리보기
  - 항목별 편집 폼 (이름, 가격, 수량)
  - 실시간 총액 계산
  - 저장/취소 버튼
- **기능**: 인라인 편집, 항목 추가/삭제

### 3.3 결과 페이지 (`/result`)
- **목적**: 계산 결과 표시 및 저장
- **구성요소**:
  - 참가자별 지불 금액 카드
  - 항목별 분할 내역
  - 계산 이름 및 상태 설정
  - 결과 저장/공유 버튼
- **시각화**: 참가자 색상 코딩, 금액 강조

### 3.4 히스토리 페이지 (`/history`)
- **목적**: 저장된 계산 기록 관리
- **구성요소**:
  - 계산 목록 (카드형 레이아웃)
  - 검색 및 필터 기능
  - 상태별 분류 탭
  - 삭제/공유 액션
- **정렬**: 최신순, 금액순, 참가자순

### 3.5 설정 페이지 (`/settings`)
- **목적**: 앱 설정 관리
- **구성요소**:
  - Gemini API 키 설정
  - 테마 설정 (라이트/다크)
  - 언어 설정
  - 개인정보 처리방침
- **보안**: API 키 마스킹 처리

## 4. 기술 아키텍처 요구사항

### 4.1 프론트엔드 기술 스택
- **프레임워크**: React 18 + TypeScript
- **빌드 도구**: Vite
- **상태 관리**: React Hook 기반 로컬 상태
- **라우팅**: React Router v6
- **스타일링**: Tailwind CSS + shadcn/ui
- **애니메이션**: Framer Motion

### 4.2 OCR 및 AI 통합
- **OCR 엔진**: Tesseract.js (클라이언트 사이드)
- **AI 서비스**: Google Gemini API (선택적)
- **이미지 처리**: HTML5 Canvas API
- **텍스트 분석**: 정규식 + 패턴 매칭

### 4.3 데이터 저장
- **로컬 스토리지**: IndexedDB (히스토리 데이터)
- **세션 스토리지**: 임시 계산 데이터
- **캐시 전략**: Service Worker 기반 캐싱

### 4.4 배포 및 운영
- **호스팅**: Vercel (정적 사이트 배포)
- **도메인**: 사용자 정의 도메인
- **모니터링**: Lighthouse CI
- **에러 추적**: 브라우저 콘솔 로깅

## 5. 데이터 모델 정의

### 5.1 핵심 타입 정의
```typescript
interface BillItem {
  id: string
  name: string
  price: number
  quantity: number
  category?: string
  assignedParticipants?: string[]
}

interface Participant {
  id: string
  name: string
  email?: string
  color?: string
}

interface CalculationResult {
  id: string
  items: BillItem[]
  participants: Participant[]
  totalAmount: number
  participantTotals: Map<string, number>
  createdAt: Date
}
```

### 5.2 히스토리 데이터 구조
```typescript
interface HistoryItem {
  id: string
  name: string
  date: string
  total: number
  participants: number
  items: number
  status: 'completed' | 'pending' | 'shared'
  details: CalculationResult
}
```

## 6. 사용자 경험 시나리오

### 6.1 기본 사용 시나리오
1. **영수증 업로드**: 사용자가 영수증을 촬영하거나 파일을 업로드
2. **OCR 처리**: 자동으로 텍스트 인식 및 항목 추출
3. **결과 검토**: 인식된 항목들을 확인하고 필요시 수정
4. **참가자 등록**: 정산에 참여할 사람들을 추가
5. **항목 할당**: 각 항목을 해당 참가자들에게 할당
6. **결과 확인**: 참가자별 지불 금액 계산 결과 확인
7. **저장/공유**: 결과를 저장하거나 다른 사람들과 공유

### 6.2 오류 처리 시나리오
- **OCR 실패**: 수동 입력 모드로 자동 전환
- **API 한도 초과**: 기본 OCR만 사용하도록 안내
- **네트워크 오류**: 로컬 데이터로 작업 계속
- **잘못된 입력**: 실시간 검증 및 오류 메시지 표시

## 7. 테스트 요구사항

### 7.1 기능 테스트
- OCR 정확도 테스트 (다양한 영수증 형태)
- 계산 로직 검증 (엣지 케이스 포함)
- 사용자 인터페이스 반응성 테스트
- 브라우저 호환성 테스트

### 7.2 성능 테스트
- 대용량 이미지 처리 성능
- 다수 항목 계산 속도
- 메모리 사용량 모니터링
- 배터리 소모량 측정 (모바일)

### 7.3 접근성 테스트
- 스크린 리더 호환성
- 키보드 네비게이션
- 색상 대비 검사
- 모바일 터치 접근성

## 8. 출시 및 마케팅 계획

### 8.1 출시 전략
- **베타 테스트**: 내부 팀 및 친구들 대상 테스트
- **소프트 런칭**: 제한된 사용자 대상 공개
- **정식 출시**: 기능 안정화 후 전면 공개

### 8.2 사용자 피드백 수집
- 앱 내 피드백 폼
- GitHub Issues를 통한 버그 리포트
- 사용성 개선 제안 수집

### 8.3 성과 지표 (KPI)
- **사용자 참여도**: 일일 활성 사용자 수
- **기능 사용률**: OCR vs 수동 입력 비율
- **정확도 지표**: OCR 성공률, 계산 오류율
- **만족도**: 사용자 리뷰 평점

## 9. 위험 요소 및 완화 방안

### 9.1 기술적 위험
- **OCR 정확도 문제**: 다중 스케일 처리 및 AI 보완으로 완화
- **브라우저 호환성**: 광범위한 테스트 및 폴리필 적용
- **성능 이슈**: 이미지 최적화 및 지연 로딩 적용

### 9.2 사업적 위험
- **API 비용**: 무료 티어 한도 관리 및 사용량 제한
- **경쟁사 등장**: 독특한 UX 및 정확도로 차별화
- **사용자 이탈**: 지속적인 기능 개선 및 UX 최적화

### 9.3 법적/개인정보 위험
- **개인정보 처리**: 클라이언트 사이드 처리로 위험 최소화
- **이미지 저장**: 서버 저장 없이 로컬 처리만 수행
- **데이터 보호**: 사용자 동의 하에 최소한의 정보만 수집

---

**승인**: Product Manager  
**검토**: Development Team, QA Team  
**다음 검토일**: 2024-02-15
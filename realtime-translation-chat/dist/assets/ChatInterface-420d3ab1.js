import{p as e,r as s,j as a,O as t,q as i,s as n,t as r,D as l,u as c}from"./ui-radix-b2de37c2.js";import{c as d,g as o,S as m,C as x,B as u,I as h,u as p,a as g,b as f,d as j,e as N,f as v}from"./index-5bf848e9.js";import{o as b,a as y,g as w,f as k,j as C,p as z,m as T,q as S,r as L,s as $,G as E,T as U,H as B,P as R,l as P,A as O,u as I,U as M,v as D}from"./ui-components-60ef1e86.js";import"./firebase-48a23e42.js";import"./translation-95ccdb9e.js";const K=e,_=c,q=s.forwardRef(({className:e,...s},i)=>a.jsx(t,{className:d("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...s,ref:i}));q.displayName=t.displayName;const A=y("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500 data-[state=open]:animate-in data-[state=closed]:animate-out",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4 border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),V=s.forwardRef(({side:e="right",className:s,children:t,...r},l)=>a.jsxs(_,{children:[a.jsx(q,{}),a.jsxs(i,{ref:l,className:d(A({side:e}),s),...r,children:[a.jsxs(n,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[a.jsx(b,{className:"h-4 w-4"}),a.jsx("span",{className:"sr-only",children:"Close"})]}),t]})]}));V.displayName=i.displayName;s.forwardRef(({className:e,...s},t)=>a.jsx(r,{ref:t,className:d("text-lg font-semibold text-foreground",e),...s})).displayName=r.displayName;function F({message:e,isOwn:t,userPreferredLanguage:i}){const[n,r]=s.useState(i),[l,c]=s.useState(!1),[h,p]=s.useState("");s.useEffect(()=>{e.translations[i]?r(i):e.originalLanguage===i&&r("original")},[e,i]);const g=()=>"original"===n?e.originalText:e.translations[n]||e.originalText,f=[{code:"original",name:`원문 (${o(e.originalLanguage)})`},...m.filter(s=>e.translations[s.code]).map(e=>({code:e.code,name:e.native}))];return a.jsx("div",{className:d("flex w-full mb-4",t?"justify-end":"justify-start"),children:a.jsxs("div",{className:d("max-w-[80%] min-w-[200px]",t?"items-end":"items-start"),children:[!t&&a.jsx("div",{className:"text-sm text-muted-foreground mb-1 px-2",children:e.userName}),a.jsxs(x,{className:d("relative py-3 px-4 shadow-sm",t?"bg-primary text-primary-foreground ml-auto":"bg-muted"),children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx("div",{className:"text-sm leading-relaxed",children:g()}),e.isTranslating&&a.jsxs("div",{className:"flex items-center gap-2 text-xs opacity-75",children:[a.jsx(w,{className:"h-3 w-3 animate-spin"}),void 0!==e.translationProgress&&void 0!==e.translationTotal?a.jsxs("span",{children:["번역 중... (",e.translationProgress,"/",e.translationTotal,")"]}):a.jsx("span",{children:"번역 중..."})]}),e.translationError&&a.jsxs("div",{className:"text-xs text-destructive",children:["번역 오류: ",e.translationError]})]}),a.jsxs("div",{className:"flex items-center justify-between mt-3 pt-2 border-t border-border/50",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[f.length>1&&a.jsxs("div",{className:"relative",children:[a.jsxs(u,{variant:"ghost",size:"sm",onClick:()=>c(!l),className:d("text-xs h-6 px-2",t?"hover:bg-primary-foreground/20 text-primary-foreground/80":"hover:bg-background/50"),children:[a.jsx(k,{className:"h-3 w-3 mr-1"}),o("original"===n?e.originalLanguage:n)]}),l&&a.jsx("div",{className:"absolute bottom-full mb-1 left-0 bg-popover border rounded-md shadow-md z-10 min-w-[150px]",children:f.map(e=>a.jsx("button",{onClick:()=>{r(e.code),c(!1)},className:d("w-full text-left px-3 py-2 text-xs hover:bg-accent",n===e.code&&"bg-accent"),children:e.name},e.code))})]}),a.jsx(u,{variant:"ghost",size:"sm",onClick:()=>(async e=>{try{await navigator.clipboard.writeText(e),p(e),setTimeout(()=>p(""),2e3)}catch(s){}})(g()),className:d("h-6 w-6 p-0",t?"hover:bg-primary-foreground/20 text-primary-foreground/80":"hover:bg-background/50"),children:h===g()?a.jsx(C,{className:"h-3 w-3"}):a.jsx(z,{className:"h-3 w-3"})})]}),a.jsxs("div",{className:d("text-xs opacity-75 flex items-center gap-1",t?"text-primary-foreground/70":"text-muted-foreground"),children:[a.jsx("span",{children:(j=e.timestamp,new Date(j).toLocaleTimeString("ko-KR",{hour:"2-digit",minute:"2-digit",hour12:!1}))}),t&&(()=>{const s=e.isTranslating?{icon:w,text:"번역 중",className:"animate-spin text-blue-500"}:e.translationError?{icon:T,text:"전송 실패",className:"text-red-500"}:e.readBy&&e.readBy.length>1?{icon:S,text:"읽음",className:"text-green-500"}:e.deliveredAt?{icon:C,text:"전송됨",className:"text-gray-500"}:{icon:L,text:"전송 중",className:"text-gray-400"},t=s.icon;return a.jsx("div",{className:"flex items-center gap-1",title:s.text,children:a.jsx(t,{className:d("h-3 w-3",s.className)})})})()]})]})]})]})});var j}function G({onSendMessage:e,onUserTyping:t,onStopTyping:i,disabled:n=!1,placeholder:r="메시지를 입력하세요...",supportedLanguages:l=["ko","en","ja","zh"]}){const[c,o]=s.useState(""),[x,p]=s.useState(l),[g,f]=s.useState(!1),[j,N]=s.useState(!1),v=s.useRef(null),b=async()=>{var s;const a=c.trim();if(a&&!g){null==i||i(),f(!0);try{await e(a,x),o(""),null==(s=v.current)||s.focus()}catch(t){}finally{f(!1)}}},y=m.filter(e=>l.includes(e.code));return a.jsxs("div",{className:"border-t bg-background p-4",children:[a.jsxs("div",{className:"relative mb-3",children:[a.jsxs(u,{variant:"outline",size:"sm",onClick:()=>N(!j),className:"text-xs",children:[a.jsx(k,{className:"h-3 w-3 mr-1"}),"번역 언어 (",x.length,")"]}),j&&a.jsxs("div",{className:"absolute bottom-full mb-2 left-0 bg-popover border rounded-md shadow-lg z-20 p-3 min-w-[300px]",children:[a.jsx("div",{className:"text-sm font-medium mb-2",children:"번역할 언어 선택:"}),a.jsx("div",{className:"grid grid-cols-2 gap-2",children:y.map(e=>a.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer hover:bg-accent rounded p-2",children:[a.jsx("input",{type:"checkbox",checked:x.includes(e.code),onChange:()=>{return s=e.code,void p(e=>e.includes(s)?e.filter(e=>e!==s):[...e,s]);var s},className:"rounded border-gray-300"}),a.jsxs("span",{className:"text-sm",children:[e.native," (",e.name,")"]})]},e.code))}),a.jsx("div",{className:"mt-3 pt-3 border-t",children:a.jsxs("div",{className:"flex gap-2",children:[a.jsx(u,{variant:"outline",size:"sm",onClick:()=>p(l),className:"text-xs",children:"전체 선택"}),a.jsx(u,{variant:"outline",size:"sm",onClick:()=>p([]),className:"text-xs",children:"선택 해제"})]})})]})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(h,{ref:v,value:c,onChange:e=>{return s=e.target.value,o(s),void(s.trim()&&!g?null==t||t():s.trim()||null==i||i());var s},onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),b())},onBlur:()=>{null==i||i()},placeholder:r,disabled:n||g,className:"flex-1",maxLength:1e3}),a.jsx(u,{onClick:b,disabled:!c.trim()||n||g,size:"icon",className:"shrink-0",children:g?a.jsx(w,{className:"h-4 w-4 animate-spin"}):a.jsx($,{className:"h-4 w-4"})})]}),x.length>0&&a.jsx("div",{className:"mt-2 flex flex-wrap gap-1",children:x.map(e=>{const s=m.find(s=>s.code===e);return a.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-md bg-primary/10 text-primary text-xs",children:(null==s?void 0:s.native)||e},e)})}),a.jsx("div",{className:"mt-1 text-right",children:a.jsxs("span",{className:d("text-xs",c.length>800?"text-destructive":"text-muted-foreground"),children:[c.length,"/1000"]})})]})}function H({users:e,className:s}){if(0===e.length)return null;return a.jsx("div",{className:d("flex justify-start w-full mb-4",s),children:a.jsx(x,{className:"py-2 px-4 bg-muted max-w-[200px]",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("div",{className:"flex space-x-1",children:[a.jsx("div",{className:"w-2 h-2 bg-muted-foreground rounded-full animate-bounce [animation-delay:-0.3s]"}),a.jsx("div",{className:"w-2 h-2 bg-muted-foreground rounded-full animate-bounce [animation-delay:-0.15s]"}),a.jsx("div",{className:"w-2 h-2 bg-muted-foreground rounded-full animate-bounce"})]}),a.jsx("div",{className:"text-xs text-muted-foreground truncate",children:1===e.length?`${e[0]}님이 입력 중`:2===e.length?`${e[0]}님과 ${e[1]}님이 입력 중`:`${e[0]}님 외 ${e.length-1}명이 입력 중`})]})})})}function W({user:e}){const t=p(),[i,n]=s.useState(null),[r,l]=s.useState([]),[c,o]=s.useState([]),[m,h]=s.useState({}),[b,y]=s.useState(null),[w,k]=s.useState(!1),[C,z]=s.useState(!1),[T,S]=s.useState(!1),[L,$]=s.useState([]),_=s.useRef(null),q=s.useRef(null);s.useEffect(()=>{const e=g.getCurrentUser();e&&y(e)},[e]),s.useEffect(()=>{const e=()=>{const e=window.innerWidth<768;S(e),e||z(!1)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),s.useEffect(()=>{const s=f.subscribeToUserRooms(e.uid,e=>{l(e),e.length>0&&!i&&n(e[0])});return()=>s()},[e.uid,i]),s.useEffect(()=>{if(!i)return void o([]);const e=f.subscribeToMessages(i.id,e=>{o(e),A()},100);return()=>e()},[i]),s.useEffect(()=>{if(!i)return void h({});const e=g.subscribeToUserPresence(i.participants,e=>{h(e)});return()=>e()},[i]),s.useEffect(()=>{if(!i||!e.uid)return void $([]);const s=f.subscribeToTypingIndicators(i.id,e.uid,e=>{$(e)});return()=>s()},[i,e.uid]);const A=()=>{var e;null==(e=_.current)||e.scrollIntoView({behavior:"smooth"})},W=()=>{if(!i||!e)return;const s=e.displayName||e.email||`User_${e.uid.slice(-4)}`;q.current&&(clearTimeout(q.current),q.current=null),f.sendTypingIndicator(i.id,e.uid,s,!1)},J=async()=>{const s=prompt("방 이름을 입력하세요:");if(null==s?void 0:s.trim())try{await f.createRoom(s.trim(),e.uid,["ko","en","ja","zh"])}catch(a){alert("방 생성에 실패했습니다.")}},Q=async()=>{try{await g.signOut()}catch(e){}},X=e=>{n(e),z(!1)},Y=()=>{t("/")},Z=async s=>{if(s.createdBy){if(s.createdBy!==e.uid)return void alert(`방 삭제 권한이 없습니다. 방을 만든 사용자만 삭제할 수 있습니다.\n\n방 만든이: ${s.createdBy}\n현재 사용자: ${e.uid}`)}else{if(!window.confirm(`"${s.name}" 방은 생성자 정보가 없는 기존 방입니다.\n\n삭제하시겠습니까? (모든 참여자가 삭제할 수 있습니다)`))return}if(window.confirm(`"${s.name}" 방을 삭제하시겠습니까?\n\n이 작업은 되돌릴 수 없으며, 방의 모든 메시지가 삭제됩니다.`))try{await f.deleteRoom(s.id,e.uid),(null==i?void 0:i.id)===s.id&&n(null)}catch(a){alert(`방 삭제 실패: ${a.message}`)}},ee=()=>{var s;return a.jsxs("div",{className:"h-full bg-card flex flex-col",children:[a.jsxs("div",{className:"p-4 border-b",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsx("h1",{className:"text-lg font-semibold",children:"번역 채팅"}),a.jsxs("div",{className:"flex gap-1",children:[a.jsx(u,{variant:"ghost",size:"icon",onClick:J,title:"새 방 만들기",children:a.jsx(R,{className:"h-4 w-4"})}),a.jsx(u,{variant:"ghost",size:"icon",onClick:Q,title:"로그아웃",children:a.jsx(P,{className:"h-4 w-4"})})]})]}),a.jsxs("div",{className:"text-sm text-muted-foreground",children:[null==b?void 0:b.displayName," (",null==(s=null==b?void 0:b.preferredLanguage)?void 0:s.toUpperCase(),")"]})]}),a.jsx("div",{className:"flex-1 overflow-y-auto",children:0===r.length?a.jsxs("div",{className:"p-4 text-center text-muted-foreground",children:[a.jsx(E,{className:"mx-auto h-12 w-12 mb-3 opacity-50"}),a.jsx("p",{className:"mb-2",children:"참여 중인 방이 없습니다"}),a.jsx(u,{onClick:J,size:"sm",className:"mt-2",children:"첫 방 만들기"})]}):a.jsx("div",{className:"p-2",children:r.map(s=>a.jsx("div",{className:d("rounded-lg mb-2 transition-colors border","hover:bg-accent focus-within:bg-accent",(null==i?void 0:i.id)===s.id&&"bg-accent border-primary"),children:a.jsxs("div",{className:"flex items-center",children:[a.jsxs("button",{onClick:()=>X(s),className:"flex-1 text-left p-3 focus:outline-none",children:[a.jsx("div",{className:"font-medium truncate",children:s.name}),a.jsxs("div",{className:"text-sm text-muted-foreground flex items-center justify-between",children:[a.jsxs("span",{children:[s.participants.length,"명 참여"]}),a.jsxs("div",{className:"flex gap-1",children:[s.supportedLanguages.slice(0,3).map(e=>a.jsx("span",{className:"text-xs opacity-60",children:e.toUpperCase()},e)),s.supportedLanguages.length>3&&a.jsxs("span",{className:"text-xs opacity-60",children:["+",s.supportedLanguages.length-3]})]})]})]}),a.jsx(u,{variant:"ghost",size:"icon",className:"h-8 w-8 mr-2 text-muted-foreground hover:text-destructive",onClick:e=>{e.stopPropagation(),Z(s)},title:s.createdBy===e.uid?"방 삭제":`삭제 불가 (만든이: ${s.createdBy})`,children:a.jsx(U,{className:"h-3 w-3"})})]})},s.id))})})]})};return a.jsxs("div",{className:"flex h-screen bg-background",children:[a.jsx("div",{className:"hidden md:flex w-80 border-r",children:a.jsx(ee,{})}),a.jsx(K,{open:C,onOpenChange:z,children:a.jsx(V,{side:"left",className:"p-0 w-80",children:a.jsx(ee,{})})}),a.jsx("div",{className:"flex-1 flex flex-col",children:!i&&T?a.jsxs("div",{className:"flex-1",children:[a.jsx("div",{className:"p-4 border-b bg-card",children:a.jsx("h1",{className:"text-lg font-semibold",children:"채팅방 목록"})}),a.jsx("div",{className:"flex-1 overflow-y-auto",children:0===r.length?a.jsxs("div",{className:"p-4 text-center text-muted-foreground",children:[a.jsx(E,{className:"mx-auto h-12 w-12 mb-3 opacity-50"}),a.jsx("p",{className:"mb-2",children:"참여 중인 방이 없습니다"}),a.jsx(u,{onClick:J,size:"sm",className:"mt-2",children:"첫 방 만들기"})]}):a.jsx("div",{className:"p-2",children:r.map(s=>a.jsx("div",{className:"border-b hover:bg-accent transition-colors",children:a.jsxs("div",{className:"flex items-center",children:[a.jsxs("button",{onClick:()=>X(s),className:"flex-1 text-left p-4 focus:outline-none",children:[a.jsx("div",{className:"font-medium truncate mb-1",children:s.name}),a.jsxs("div",{className:"text-sm text-muted-foreground flex items-center justify-between",children:[a.jsxs("span",{children:[s.participants.length,"명 참여"]}),a.jsx("div",{className:"flex gap-1",children:s.supportedLanguages.slice(0,3).map(e=>a.jsx("span",{className:"text-xs opacity-60",children:e.toUpperCase()},e))})]})]}),a.jsx(u,{variant:"ghost",size:"icon",className:"h-8 w-8 mr-2 text-muted-foreground hover:text-destructive",onClick:e=>{e.stopPropagation(),Z(s)},title:s.createdBy===e.uid?"방 삭제":`삭제 불가 (만든이: ${s.createdBy})`,children:a.jsx(U,{className:"h-3 w-3"})})]})},s.id))})}),a.jsx("div",{className:"p-4 border-t bg-card",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("div",{className:"text-sm text-muted-foreground",children:null==b?void 0:b.displayName}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(u,{onClick:Y,variant:"outline",size:"sm",children:a.jsx(B,{className:"h-4 w-4"})}),a.jsxs(u,{onClick:J,size:"sm",children:[a.jsx(R,{className:"h-4 w-4 mr-1"}),"새 방"]}),a.jsx(u,{onClick:Q,variant:"outline",size:"sm",children:a.jsx(P,{className:"h-4 w-4"})})]})]})})]}):i?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"p-4 border-b bg-card",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[T&&a.jsx(u,{variant:"ghost",size:"icon",onClick:()=>{T&&n(null)},className:"md:hidden",children:a.jsx(O,{className:"h-4 w-4"})}),!T&&a.jsx(u,{variant:"ghost",size:"icon",onClick:()=>z(!0),className:"md:hidden",children:a.jsx(I,{className:"h-4 w-4"})}),a.jsxs("div",{children:[a.jsx("h2",{className:"text-lg font-semibold truncate",children:i.name}),a.jsxs("div",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[a.jsx(M,{className:"h-3 w-3"}),Object.values(m).filter(e=>e.isOnline).length,"/",i.participants.length," ","온라인"]})]})]}),a.jsxs("div",{className:"flex gap-1",children:[a.jsx(u,{variant:"ghost",size:"icon",onClick:Y,title:"홈으로",children:a.jsx(B,{className:"h-4 w-4"})}),a.jsx(u,{variant:"ghost",size:"icon",onClick:()=>{t("/settings")},title:"설정",children:a.jsx(D,{className:"h-4 w-4"})})]})]}),a.jsx("div",{className:"mt-2 flex flex-wrap gap-1",children:i.supportedLanguages.map(e=>a.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-md bg-primary/10 text-primary text-xs",children:e.toUpperCase()},e))})]}),a.jsxs("div",{className:"flex-1 overflow-y-auto p-2 md:p-4 space-y-2",children:[0===c.length?a.jsxs("div",{className:"text-center text-muted-foreground py-8",children:[a.jsx("p",{children:"아직 메시지가 없습니다"}),a.jsx("p",{className:"text-sm",children:"첫 메시지를 보내보세요!"})]}):c.map(s=>a.jsx(F,{message:s,isOwn:s.userId===e.uid,userPreferredLanguage:(null==b?void 0:b.preferredLanguage)||"ko"},s.id)),a.jsx(H,{users:L}),a.jsx("div",{ref:_})]}),a.jsx(G,{onSendMessage:async(s,a)=>{if(!i||!e)return;const t=e.displayName||e.email||`User_${e.uid.slice(-4)}`;k(!0),W();try{await f.sendMessage(i.id,e.uid,t,s,a)}catch(n){alert("메시지 전송에 실패했습니다: "+n.message)}finally{k(!1)}},onUserTyping:()=>{if(!i||!e)return;const s=e.displayName||e.email||`User_${e.uid.slice(-4)}`;q.current&&clearTimeout(q.current),f.sendTypingIndicator(i.id,e.uid,s,!0),q.current=setTimeout(()=>{W()},3e3)},onStopTyping:W,disabled:w,supportedLanguages:i.supportedLanguages})]}):a.jsx("div",{className:"flex-1 flex items-center justify-center p-4",children:a.jsxs(x,{className:"w-full max-w-md text-center",children:[a.jsx(j,{children:a.jsxs(N,{className:"flex items-center justify-center gap-2",children:[a.jsx(u,{variant:"ghost",size:"icon",onClick:()=>z(!0),className:"md:hidden",children:a.jsx(I,{className:"h-4 w-4"})}),"방을 선택하세요"]})}),a.jsxs(v,{children:[a.jsxs("p",{className:"text-muted-foreground mb-4",children:[T?"위의 메뉴를 눌러":"왼쪽에서"," 방을 선택하거나 새 방을 만들어보세요"]}),a.jsxs(u,{onClick:J,className:"w-full",children:[a.jsx(R,{className:"h-4 w-4 mr-2"}),"새 방 만들기"]})]})]})})})]})}s.forwardRef(({className:e,...s},t)=>a.jsx(l,{ref:t,className:d("text-sm text-muted-foreground",e),...s})).displayName=l.displayName;export{W as default};

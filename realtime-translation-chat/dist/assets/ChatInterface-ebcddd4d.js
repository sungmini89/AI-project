var e=Object.defineProperty,t=(t,s,a)=>(((t,s,a)=>{s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a})(t,"symbol"!=typeof s?s+"":s,a),a);import{p as s,r as a,j as n,O as r,q as i,s as o,t as c,D as l,u as d}from"./ui-radix-51406873.js";import{c as m,g as u,S as h,C as g,B as x,I as p,d as f,a as y,u as j,b as v,e as w,f as N}from"./index-64ac6d90.js";import{X as b,a as T,g as L,f as S,i as k,l as C,m as E,n as z,o as A,p as D,G as I,P as $,k as M,A as U,q as P,U as R,r as q}from"./ui-components-5cae29bd.js";import{m as O,t as _,n as B,h as K,l as Q,v as J,q as H,w as F,x as V,y as W,z as Y,p as G}from"./firebase-d813b94f.js";import"./translation-95ccdb9e.js";const X=s,Z=d,ee=a.forwardRef(({className:e,...t},s)=>n.jsx(r,{className:m("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t,ref:s}));ee.displayName=r.displayName;const te=T("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500 data-[state=open]:animate-in data-[state=closed]:animate-out",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4 border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),se=a.forwardRef(({side:e="right",className:t,children:s,...a},r)=>n.jsxs(Z,{children:[n.jsx(ee,{}),n.jsxs(i,{ref:r,className:m(te({side:e}),t),...a,children:[n.jsxs(o,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[n.jsx(b,{className:"h-4 w-4"}),n.jsx("span",{className:"sr-only",children:"Close"})]}),s]})]}));se.displayName=i.displayName;a.forwardRef(({className:e,...t},s)=>n.jsx(c,{ref:s,className:m("text-lg font-semibold text-foreground",e),...t})).displayName=c.displayName;function ae({message:e,isOwn:t,userPreferredLanguage:s}){const[r,i]=a.useState(s),[o,c]=a.useState(!1),[l,d]=a.useState("");a.useEffect(()=>{e.translations[s]?i(s):e.originalLanguage===s&&i("original")},[e,s]);const p=()=>"original"===r?e.originalText:e.translations[r]||e.originalText,f=[{code:"original",name:`원문 (${u(e.originalLanguage)})`},...h.filter(t=>e.translations[t.code]).map(e=>({code:e.code,name:e.native}))];return n.jsx("div",{className:m("flex w-full mb-4",t?"justify-end":"justify-start"),children:n.jsxs("div",{className:m("max-w-[80%] min-w-[200px]",t?"items-end":"items-start"),children:[!t&&n.jsx("div",{className:"text-sm text-muted-foreground mb-1 px-2",children:e.userName}),n.jsxs(g,{className:m("relative py-3 px-4 shadow-sm",t?"bg-primary text-primary-foreground ml-auto":"bg-muted"),children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx("div",{className:"text-sm leading-relaxed",children:p()}),e.isTranslating&&n.jsxs("div",{className:"flex items-center gap-2 text-xs opacity-75",children:[n.jsx(L,{className:"h-3 w-3 animate-spin"}),void 0!==e.translationProgress&&void 0!==e.translationTotal?n.jsxs("span",{children:["번역 중... (",e.translationProgress,"/",e.translationTotal,")"]}):n.jsx("span",{children:"번역 중..."})]}),e.translationError&&n.jsxs("div",{className:"text-xs text-destructive",children:["번역 오류: ",e.translationError]})]}),n.jsxs("div",{className:"flex items-center justify-between mt-3 pt-2 border-t border-border/50",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[f.length>1&&n.jsxs("div",{className:"relative",children:[n.jsxs(x,{variant:"ghost",size:"sm",onClick:()=>c(!o),className:m("text-xs h-6 px-2",t?"hover:bg-primary-foreground/20 text-primary-foreground/80":"hover:bg-background/50"),children:[n.jsx(S,{className:"h-3 w-3 mr-1"}),u("original"===r?e.originalLanguage:r)]}),o&&n.jsx("div",{className:"absolute bottom-full mb-1 left-0 bg-popover border rounded-md shadow-md z-10 min-w-[150px]",children:f.map(e=>n.jsx("button",{onClick:()=>{i(e.code),c(!1)},className:m("w-full text-left px-3 py-2 text-xs hover:bg-accent",r===e.code&&"bg-accent"),children:e.name},e.code))})]}),n.jsx(x,{variant:"ghost",size:"sm",onClick:()=>(async e=>{try{await navigator.clipboard.writeText(e),d(e),setTimeout(()=>d(""),2e3)}catch(t){}})(p()),className:m("h-6 w-6 p-0",t?"hover:bg-primary-foreground/20 text-primary-foreground/80":"hover:bg-background/50"),children:l===p()?n.jsx(k,{className:"h-3 w-3"}):n.jsx(C,{className:"h-3 w-3"})})]}),n.jsxs("div",{className:m("text-xs opacity-75 flex items-center gap-1",t?"text-primary-foreground/70":"text-muted-foreground"),children:[n.jsx("span",{children:(y=e.timestamp,new Date(y).toLocaleTimeString("ko-KR",{hour:"2-digit",minute:"2-digit",hour12:!1}))}),t&&(()=>{const t=e.isTranslating?{icon:L,text:"번역 중",className:"animate-spin text-blue-500"}:e.translationError?{icon:E,text:"전송 실패",className:"text-red-500"}:e.readBy&&e.readBy.length>1?{icon:z,text:"읽음",className:"text-green-500"}:e.deliveredAt?{icon:k,text:"전송됨",className:"text-gray-500"}:{icon:A,text:"전송 중",className:"text-gray-400"},s=t.icon;return n.jsx("div",{className:"flex items-center gap-1",title:t.text,children:n.jsx(s,{className:m("h-3 w-3",t.className)})})})()]})]})]})]})});var y}function ne({onSendMessage:e,onUserTyping:t,onStopTyping:s,disabled:r=!1,placeholder:i="메시지를 입력하세요...",supportedLanguages:o=["ko","en","ja","zh"]}){const[c,l]=a.useState(""),[d,u]=a.useState(o),[g,f]=a.useState(!1),[y,j]=a.useState(!1),v=a.useRef(null),w=async()=>{var t;const a=c.trim();if(a&&!g){null==s||s(),f(!0);try{await e(a,d),l(""),null==(t=v.current)||t.focus()}catch(n){}finally{f(!1)}}},N=h.filter(e=>o.includes(e.code));return n.jsxs("div",{className:"border-t bg-background p-4",children:[n.jsxs("div",{className:"relative mb-3",children:[n.jsxs(x,{variant:"outline",size:"sm",onClick:()=>j(!y),className:"text-xs",children:[n.jsx(S,{className:"h-3 w-3 mr-1"}),"번역 언어 (",d.length,")"]}),y&&n.jsxs("div",{className:"absolute bottom-full mb-2 left-0 bg-popover border rounded-md shadow-lg z-20 p-3 min-w-[300px]",children:[n.jsx("div",{className:"text-sm font-medium mb-2",children:"번역할 언어 선택:"}),n.jsx("div",{className:"grid grid-cols-2 gap-2",children:N.map(e=>n.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer hover:bg-accent rounded p-2",children:[n.jsx("input",{type:"checkbox",checked:d.includes(e.code),onChange:()=>{return t=e.code,void u(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t]);var t},className:"rounded border-gray-300"}),n.jsxs("span",{className:"text-sm",children:[e.native," (",e.name,")"]})]},e.code))}),n.jsx("div",{className:"mt-3 pt-3 border-t",children:n.jsxs("div",{className:"flex gap-2",children:[n.jsx(x,{variant:"outline",size:"sm",onClick:()=>u(o),className:"text-xs",children:"전체 선택"}),n.jsx(x,{variant:"outline",size:"sm",onClick:()=>u([]),className:"text-xs",children:"선택 해제"})]})})]})]}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx(p,{ref:v,value:c,onChange:e=>{return a=e.target.value,l(a),void(a.trim()&&!g?null==t||t():a.trim()||null==s||s());var a},onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),w())},onBlur:()=>{null==s||s()},placeholder:i,disabled:r||g,className:"flex-1",maxLength:1e3}),n.jsx(x,{onClick:w,disabled:!c.trim()||r||g,size:"icon",className:"shrink-0",children:g?n.jsx(L,{className:"h-4 w-4 animate-spin"}):n.jsx(D,{className:"h-4 w-4"})})]}),d.length>0&&n.jsx("div",{className:"mt-2 flex flex-wrap gap-1",children:d.map(e=>{const t=h.find(t=>t.code===e);return n.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-md bg-primary/10 text-primary text-xs",children:(null==t?void 0:t.native)||e},e)})}),n.jsx("div",{className:"mt-1 text-right",children:n.jsxs("span",{className:m("text-xs",c.length>800?"text-destructive":"text-muted-foreground"),children:[c.length,"/1000"]})})]})}function re({users:e,className:t}){if(0===e.length)return null;return n.jsx("div",{className:m("flex justify-start w-full mb-4",t),children:n.jsx(g,{className:"py-2 px-4 bg-muted max-w-[200px]",children:n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("div",{className:"flex space-x-1",children:[n.jsx("div",{className:"w-2 h-2 bg-muted-foreground rounded-full animate-bounce [animation-delay:-0.3s]"}),n.jsx("div",{className:"w-2 h-2 bg-muted-foreground rounded-full animate-bounce [animation-delay:-0.15s]"}),n.jsx("div",{className:"w-2 h-2 bg-muted-foreground rounded-full animate-bounce"})]}),n.jsx("div",{className:"text-xs text-muted-foreground truncate",children:1===e.length?`${e[0]}님이 입력 중`:2===e.length?`${e[0]}님과 ${e[1]}님이 입력 중`:`${e[0]}님 외 ${e.length-1}명이 입력 중`})]})})})}a.forwardRef(({className:e,...t},s)=>n.jsx(l,{ref:s,className:m("text-sm text-muted-foreground",e),...t})).displayName=l.displayName;const ie=class e{constructor(){t(this,"quotas",new Map),this.initializeQuotas()}static getInstance(){return e.instance||(e.instance=new e),e.instance}initializeQuotas(){const e=(new Date).toDateString(),t=localStorage.getItem("translation-quotas");if(t)try{const s=JSON.parse(t);if(s.date===e)return void(this.quotas=new Map(s.quotas))}catch(s){}this.quotas.set("mymemory",{provider:"mymemory",dailyLimit:1e3,currentUsage:0,lastReset:Date.now()}),this.quotas.set("libretranslate",{provider:"libretranslate",dailyLimit:100,currentUsage:0,lastReset:Date.now()}),this.saveQuotas()}saveQuotas(){const e={date:(new Date).toDateString(),quotas:Array.from(this.quotas.entries())};localStorage.setItem("translation-quotas",JSON.stringify(e))}canUseProvider(e){const t=this.quotas.get(e);return!!t&&t.currentUsage<t.dailyLimit}incrementUsage(e){const t=this.quotas.get(e);t&&(t.currentUsage++,this.saveQuotas())}getQuota(e){return this.quotas.get(e)}};t(ie,"instance");let oe=ie;async function ce(e,t,s){const a=oe.getInstance();if(!a.canUseProvider("mymemory"))throw new Error("MyMemory daily quota exceeded");const n=new URLSearchParams({q:e,langpair:`${t}|${s}`,de:"your-email@domain.com"});try{const e=await fetch(`https://api.mymemory.translated.net/get?${n}`,{method:"GET",headers:{Accept:"application/json"}});if(!e.ok)throw new Error(`MyMemory API error: ${e.status}`);const r=await e.json();if(200!==r.responseStatus)throw new Error(`MyMemory translation failed: ${r.responseDetails}`);return a.incrementUsage("mymemory"),{translatedText:r.responseData.translatedText,sourceLanguage:t,targetLanguage:s,confidence:r.responseData.match/100,provider:"mymemory"}}catch(r){throw r}}async function le(e,t,s){const a=oe.getInstance();if(!a.canUseProvider("libretranslate"))throw new Error("LibreTranslate daily quota exceeded");const n={}.VITE_LIBRETRANSLATE_KEY;try{const r=await fetch("https://libretranslate.de",{method:"POST",headers:{"Content-Type":"application/json",...n&&{Authorization:`Bearer ${n}`}},body:JSON.stringify({q:e,source:t,target:s,format:"text"})});if(!r.ok)throw new Error(`LibreTranslate API error: ${r.status}`);const i=await r.json();return a.incrementUsage("libretranslate"),{translatedText:i.translatedText,sourceLanguage:t,targetLanguage:s,provider:"libretranslate"}}catch(r){throw r}}const de={ko:{en:"안녕하세요 - Hello\n감사합니다 - Thank you\n죄송합니다 - Sorry\n네 - Yes\n아니요 - No",ja:"안녕하세요 - こんにちは\n감사합니다 - ありがとうございます\n죄송합니다 - すみません"},en:{ko:"Hello - 안녕하세요\nThank you - 감사합니다\nSorry - 죄송합니다\nYes - 네\nNo - 아니요",ja:"Hello - こんにちは\nThank you - ありがとうございます\nSorry - すみません"},ja:{ko:"こんにちは - 안녕하세요\nありがとうございます - 감사합니다\nすみません - 죄송합니다",en:"こんにちは - Hello\nありがとうございます - Thank you\nすみません - Sorry"}};async function me(e,t,s){var a;const n=null==(a=de[t])?void 0:a[s];if(!n)throw new Error(`Offline translation not available for ${t} to ${s}`);const r=e.toLowerCase(),i=n.split("\n");for(const o of i){const[e,a]=o.split(" - ");if(e&&a&&r.includes(e.toLowerCase()))return{translatedText:a,sourceLanguage:t,targetLanguage:s,confidence:.6,provider:"offline"}}return{translatedText:`${e} (번역 불가 - Translation unavailable)`,sourceLanguage:t,targetLanguage:s,confidence:.1,provider:"offline"}}class ue{constructor(){t(this,"cache",new Map),t(this,"maxSize",2e3),t(this,"maxAge",864e5)}getCacheKey(e,t,s){return`${t}-${s}-${e.length>100?`${e.slice(0,50)}...${e.slice(-50)}[${e.length}]`:e}`}get(e,t,s){const a=this.getCacheKey(e,t,s),n=this.cache.get(a);return n?Date.now()-n.timestamp>this.maxAge?(this.cache.delete(a),null):(n.accessCount++,n.timestamp=Date.now(),this.cache.set(a,n),n.result):null}set(e,t,s,a){this.cache.size>=this.maxSize&&this.evictLRU();const n=t||"auto",r=this.getCacheKey(e,n,s);this.cache.set(r,{result:a,timestamp:Date.now(),accessCount:1})}evictLRU(){let e="",t=Date.now(),s=1/0;for(const[a,n]of this.cache)(n.timestamp<t||n.timestamp===t&&n.accessCount<s)&&(e=a,t=n.timestamp,s=n.accessCount);e&&this.cache.delete(e)}clear(){this.cache.clear()}}const he=class e{constructor(){t(this,"cache",new ue),t(this,"settings",{preferredProvider:"auto",autoDetectLanguage:!0,fallbackToOffline:!0,cacheTranslations:!0}),this.loadSettings()}static getInstance(){return e.instance||(e.instance=new e),e.instance}loadSettings(){try{const e=localStorage.getItem("translation-settings");e&&(this.settings={...this.settings,...JSON.parse(e)})}catch(e){}}saveSettings(){localStorage.setItem("translation-settings",JSON.stringify(this.settings))}updateSettings(e){this.settings={...this.settings,...e},this.saveSettings()}getSettings(){return{...this.settings}}async translate(e,t,s){try{const a=e.trim();if(!a)throw new Error("Empty text provided");const n=s||(this.settings.autoDetectLanguage?f(a):"en");if(n===t)return{translatedText:a,sourceLanguage:n,targetLanguage:t,confidence:1,provider:"offline"};if(this.settings.cacheTranslations){const e=this.cache.get(a,n||"auto",t);if(e)return e}const r=await this.translateWithFallback(a,n||"auto",t);return this.settings.cacheTranslations&&r.confidence&&r.confidence>.3&&this.cache.set(a,n||"auto",t,r),r}catch(a){throw a}}async translateWithFallback(e,t,s){const a=this.getProviderChain(),n=[];for(const i of a)try{switch(i){case"mymemory":return await ce(e,t,s);case"libretranslate":return await le(e,t,s);case"offline":return await me(e,t,s);default:throw new Error(`Unknown provider: ${i}`)}}catch(r){n.push(r);continue}throw new Error(`All translation providers failed. Errors: ${n.map(e=>e.message).join(", ")}`)}getProviderChain(){const{preferredProvider:e,fallbackToOffline:t}=this.settings;if("auto"!==e){const s=[e];return t&&"offline"!==e&&s.push("offline"),s}const s=["mymemory","libretranslate"];return t&&s.push("offline"),s}async translateToMultipleLanguages(e,t,s){const a={},n=t.map(async t=>{try{const n=await this.translate(e,t,s);a[t]=n}catch(n){a[t]={translatedText:e,sourceLanguage:s||"unknown",targetLanguage:t,confidence:0,provider:"offline"}}});return await Promise.allSettled(n),a}getStatistics(){return{cacheSize:this.cache.cache.size,settings:this.settings}}clearCache(){this.cache.clear()}};t(he,"instance");const ge=he.getInstance(),xe=class e{constructor(){t(this,"activeListeners",new Map)}static getInstance(){return e.instance||(e.instance=new e),e.instance}async createRoom(e,t,s){try{const a={name:e,participants:[t],createdAt:O(),updatedAt:O(),supportedLanguages:s,createdBy:t};return(await _(B(y,"rooms"),a)).id}catch(a){throw a}}async joinRoom(e,t){try{const s=K(y,"rooms",e);await Q(s,{participants:[...new Set([t])],updatedAt:O()})}catch(s){throw s}}async leaveRoom(e,t){try{const s=K(y,"rooms",e),a=await J(H(B(y,"rooms"),F("__name__","==",e)));if(!a.empty){const e=a.docs[0].data().participants.filter(e=>e!==t);0===e.length?await V(s):await Q(s,{participants:e,updatedAt:O()})}}catch(s){throw s}}async sendMessage(e,t,s,a,n=[]){try{const r={userId:t,userName:s,originalText:a,originalLanguage:"auto",translations:{},timestamp:Date.now(),isTranslating:n.length>0},i=await _(B(y,"rooms",e,"messages"),{...r,createdAt:O()});return n.length>0&&(await Q(i,{translationProgress:0,translationTotal:n.length}),this.translateMessage(e,i.id,a,n).catch(t=>{this.updateMessageTranslationError(e,i.id,t.message)})),i.id}catch(r){throw r}}async translateMessage(e,t,s,a){try{const n=K(y,"rooms",e,"messages",t),r={},i=async(e,t)=>{r[e]=t,await Q(n,{translations:{...r},updatedAt:O()})},o=a.map(async e=>{try{const t=await ge.translate(s,e);return await i(e,t.translatedText),{lang:e,result:t}}catch(t){throw await i(e,`[번역 실패: ${e}]`),t}}),c=(await Promise.allSettled(o)).some(e=>"rejected"===e.status);await Q(n,{translations:r,isTranslating:!1,translationError:c?"일부 번역 실패":void 0,updatedAt:O()})}catch(n){throw n}}async updateMessageTranslationError(e,t,s){try{const a=K(y,"rooms",e,"messages",t);await Q(a,{isTranslating:!1,translationError:s,updatedAt:O()})}catch(a){}}subscribeToMessages(e,t,s=50){const a=B(y,"rooms",e,"messages"),n=H(a,Y("createdAt","desc"),W(s)),r=G(n,e=>{const s=[];e.forEach(e=>{const t=e.data();t&&s.push({id:e.id,userId:t.userId,userName:t.userName,originalText:t.originalText,originalLanguage:t.originalLanguage||"auto",translations:t.translations||{},timestamp:t.timestamp||Date.now(),isTranslating:t.isTranslating||!1,translationError:t.translationError})}),t(s.reverse())},e=>{t([])});return this.activeListeners.set(`messages-${e}`,r),r}subscribeToUserRooms(e,t){const s=B(y,"rooms"),a=H(s,F("participants","array-contains",e)),n=G(a,e=>{const s=[];e.forEach(e=>{var t,a;const n=e.data();n&&s.push({id:e.id,name:n.name,participants:n.participants||[],createdAt:(null==(t=n.createdAt)?void 0:t.toMillis())||Date.now(),updatedAt:(null==(a=n.updatedAt)?void 0:a.toMillis())||Date.now(),supportedLanguages:n.supportedLanguages||["en","ko"]})}),t(s)},e=>{t([])});return this.activeListeners.set(`rooms-${e}`,n),n}async getRoomDetails(e){var t,s;try{const a=await J(H(B(y,"rooms"),F("__name__","==",e)));if(a.empty)return null;const n=a.docs[0].data();return{id:e,name:n.name,participants:n.participants||[],createdAt:(null==(t=n.createdAt)?void 0:t.toMillis())||Date.now(),updatedAt:(null==(s=n.updatedAt)?void 0:s.toMillis())||Date.now(),supportedLanguages:n.supportedLanguages||["en","ko"]}}catch(a){return null}}async deleteMessage(e,t){try{const s=K(y,"rooms",e,"messages",t);await V(s)}catch(s){throw s}}cleanup(){for(const[t,s]of this.activeListeners)try{s()}catch(e){}this.activeListeners.clear()}cleanupListener(e){const t=this.activeListeners.get(e);if(t)try{t(),this.activeListeners.delete(e)}catch(s){}}async sendTypingIndicator(e,t,s,a){try{const n=K(y,"rooms",e,"typing",t);a?await Q(n,{userName:s,isTyping:!0,timestamp:Date.now()}).catch(async()=>{const a=B(y,"rooms",e,"typing");await _(a,{userId:t,userName:s,isTyping:!0,timestamp:Date.now()})}):await Q(n,{isTyping:!1,timestamp:Date.now()}).catch(()=>{})}catch(n){}}subscribeToTypingIndicators(e,t,s){const a=B(y,"rooms",e,"typing"),n=H(a,F("isTyping","==",!0)),r=G(n,e=>{const a=[],n=Date.now();e.forEach(e=>{const s=e.data();s.userId!==t&&s.isTyping&&n-s.timestamp<5e3&&a.push(s.userName)}),s(a)},e=>{s([])});return this.activeListeners.set(`typing-${e}`,r),r}async getMessageCount(e){try{const t=B(y,"rooms",e,"messages");return(await J(t)).size}catch(t){return 0}}};t(xe,"instance");const pe=xe.getInstance();function fe({user:e}){const[t,s]=a.useState(null),[r,i]=a.useState([]),[o,c]=a.useState([]),[l,d]=a.useState({}),[u,h]=a.useState(null),[p,f]=a.useState(!1),[y,b]=a.useState(!1),[T,L]=a.useState(!1),[S,k]=a.useState([]),C=a.useRef(null),E=a.useRef(null);a.useEffect(()=>{const e=j.getCurrentUser();e&&h(e)},[e]),a.useEffect(()=>{const e=()=>{const e=window.innerWidth<768;L(e),e||b(!1)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),a.useEffect(()=>{const a=pe.subscribeToUserRooms(e.uid,e=>{i(e),e.length>0&&!t&&s(e[0])});return()=>a()},[e.uid,t]),a.useEffect(()=>{if(!t)return void c([]);const e=pe.subscribeToMessages(t.id,e=>{c(e),z()},100);return()=>e()},[t]),a.useEffect(()=>{if(!t)return void d({});const e=j.subscribeToUserPresence(t.participants,e=>{d(e)});return()=>e()},[t]),a.useEffect(()=>{if(!t||!e.uid)return void k([]);const s=pe.subscribeToTypingIndicators(t.id,e.uid,e=>{k(e)});return()=>s()},[t,e.uid]);const z=()=>{var e;null==(e=C.current)||e.scrollIntoView({behavior:"smooth"})},A=()=>{t&&u&&(E.current&&(clearTimeout(E.current),E.current=null),pe.sendTypingIndicator(t.id,e.uid,u.displayName,!1))},D=async()=>{const t=prompt("방 이름을 입력하세요:");if(null==t?void 0:t.trim())try{await pe.createRoom(t.trim(),e.uid,["ko","en","ja","zh"])}catch(s){alert("방 생성에 실패했습니다.")}},O=async()=>{try{await j.signOut()}catch(e){}},_=e=>{s(e),b(!1)},B=()=>{var e;return n.jsxs("div",{className:"h-full bg-card flex flex-col",children:[n.jsxs("div",{className:"p-4 border-b",children:[n.jsxs("div",{className:"flex items-center justify-between mb-3",children:[n.jsx("h1",{className:"text-lg font-semibold",children:"번역 채팅"}),n.jsxs("div",{className:"flex gap-1",children:[n.jsx(x,{variant:"ghost",size:"icon",onClick:D,title:"새 방 만들기",children:n.jsx($,{className:"h-4 w-4"})}),n.jsx(x,{variant:"ghost",size:"icon",onClick:O,title:"로그아웃",children:n.jsx(M,{className:"h-4 w-4"})})]})]}),n.jsxs("div",{className:"text-sm text-muted-foreground",children:[null==u?void 0:u.displayName," (",null==(e=null==u?void 0:u.preferredLanguage)?void 0:e.toUpperCase(),")"]})]}),n.jsx("div",{className:"flex-1 overflow-y-auto",children:0===r.length?n.jsxs("div",{className:"p-4 text-center text-muted-foreground",children:[n.jsx(I,{className:"mx-auto h-12 w-12 mb-3 opacity-50"}),n.jsx("p",{className:"mb-2",children:"참여 중인 방이 없습니다"}),n.jsx(x,{onClick:D,size:"sm",className:"mt-2",children:"첫 방 만들기"})]}):n.jsx("div",{className:"p-2",children:r.map(e=>n.jsxs("button",{onClick:()=>_(e),className:m("w-full text-left p-3 rounded-lg mb-2 transition-colors","hover:bg-accent focus:bg-accent focus:outline-none",(null==t?void 0:t.id)===e.id&&"bg-accent"),children:[n.jsx("div",{className:"font-medium truncate",children:e.name}),n.jsxs("div",{className:"text-sm text-muted-foreground flex items-center justify-between",children:[n.jsxs("span",{children:[e.participants.length,"명 참여"]}),n.jsxs("div",{className:"flex gap-1",children:[e.supportedLanguages.slice(0,3).map(e=>n.jsx("span",{className:"text-xs opacity-60",children:e.toUpperCase()},e)),e.supportedLanguages.length>3&&n.jsxs("span",{className:"text-xs opacity-60",children:["+",e.supportedLanguages.length-3]})]})]})]},e.id))})})]})};return n.jsxs("div",{className:"flex h-screen bg-background",children:[n.jsx("div",{className:"hidden md:flex w-80 border-r",children:n.jsx(B,{})}),n.jsx(X,{open:y,onOpenChange:b,children:n.jsx(se,{side:"left",className:"p-0 w-80",children:n.jsx(B,{})})}),n.jsx("div",{className:"flex-1 flex flex-col",children:!t&&T?n.jsxs("div",{className:"flex-1",children:[n.jsx("div",{className:"p-4 border-b bg-card",children:n.jsx("h1",{className:"text-lg font-semibold",children:"채팅방 목록"})}),n.jsx("div",{className:"flex-1 overflow-y-auto",children:0===r.length?n.jsxs("div",{className:"p-4 text-center text-muted-foreground",children:[n.jsx(I,{className:"mx-auto h-12 w-12 mb-3 opacity-50"}),n.jsx("p",{className:"mb-2",children:"참여 중인 방이 없습니다"}),n.jsx(x,{onClick:D,size:"sm",className:"mt-2",children:"첫 방 만들기"})]}):n.jsx("div",{className:"p-2",children:r.map(e=>n.jsxs("button",{onClick:()=>_(e),className:"w-full text-left p-4 border-b hover:bg-accent transition-colors",children:[n.jsx("div",{className:"font-medium truncate mb-1",children:e.name}),n.jsxs("div",{className:"text-sm text-muted-foreground flex items-center justify-between",children:[n.jsxs("span",{children:[e.participants.length,"명 참여"]}),n.jsx("div",{className:"flex gap-1",children:e.supportedLanguages.slice(0,3).map(e=>n.jsx("span",{className:"text-xs opacity-60",children:e.toUpperCase()},e))})]})]},e.id))})}),n.jsx("div",{className:"p-4 border-t bg-card",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("div",{className:"text-sm text-muted-foreground",children:null==u?void 0:u.displayName}),n.jsxs("div",{className:"flex gap-2",children:[n.jsxs(x,{onClick:D,size:"sm",children:[n.jsx($,{className:"h-4 w-4 mr-1"}),"새 방"]}),n.jsx(x,{onClick:O,variant:"outline",size:"sm",children:n.jsx(M,{className:"h-4 w-4"})})]})]})})]}):t?n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"p-4 border-b bg-card",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[T&&n.jsx(x,{variant:"ghost",size:"icon",onClick:()=>{T&&s(null)},className:"md:hidden",children:n.jsx(U,{className:"h-4 w-4"})}),!T&&n.jsx(x,{variant:"ghost",size:"icon",onClick:()=>b(!0),className:"md:hidden",children:n.jsx(P,{className:"h-4 w-4"})}),n.jsxs("div",{children:[n.jsx("h2",{className:"text-lg font-semibold truncate",children:t.name}),n.jsxs("div",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[n.jsx(R,{className:"h-3 w-3"}),Object.values(l).filter(e=>e.isOnline).length,"/",t.participants.length," 온라인"]})]})]}),n.jsx("div",{className:"flex gap-1",children:n.jsx(x,{variant:"ghost",size:"icon",children:n.jsx(q,{className:"h-4 w-4"})})})]}),n.jsx("div",{className:"mt-2 flex flex-wrap gap-1",children:t.supportedLanguages.map(e=>n.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-md bg-primary/10 text-primary text-xs",children:e.toUpperCase()},e))})]}),n.jsxs("div",{className:"flex-1 overflow-y-auto p-2 md:p-4 space-y-2",children:[0===o.length?n.jsxs("div",{className:"text-center text-muted-foreground py-8",children:[n.jsx("p",{children:"아직 메시지가 없습니다"}),n.jsx("p",{className:"text-sm",children:"첫 메시지를 보내보세요!"})]}):o.map(t=>n.jsx(ae,{message:t,isOwn:t.userId===e.uid,userPreferredLanguage:(null==u?void 0:u.preferredLanguage)||"ko"},t.id)),n.jsx(re,{users:S}),n.jsx("div",{ref:C})]}),n.jsx(ne,{onSendMessage:async(s,a)=>{if(t&&u){f(!0),A();try{await pe.sendMessage(t.id,e.uid,u.displayName,s,a)}catch(n){throw n}finally{f(!1)}}},onUserTyping:()=>{t&&u&&(E.current&&clearTimeout(E.current),pe.sendTypingIndicator(t.id,e.uid,u.displayName,!0),E.current=setTimeout(()=>{A()},3e3))},onStopTyping:A,disabled:p,supportedLanguages:t.supportedLanguages})]}):n.jsx("div",{className:"flex-1 flex items-center justify-center p-4",children:n.jsxs(g,{className:"w-full max-w-md text-center",children:[n.jsx(v,{children:n.jsxs(w,{className:"flex items-center justify-center gap-2",children:[n.jsx(x,{variant:"ghost",size:"icon",onClick:()=>b(!0),className:"md:hidden",children:n.jsx(P,{className:"h-4 w-4"})}),"방을 선택하세요"]})}),n.jsxs(N,{children:[n.jsxs("p",{className:"text-muted-foreground mb-4",children:[T?"위의 메뉴를 눌러":"왼쪽에서"," 방을 선택하거나 새 방을 만들어보세요"]}),n.jsxs(x,{onClick:D,className:"w-full",children:[n.jsx($,{className:"h-4 w-4 mr-2"}),"새 방 만들기"]})]})]})})})]})}export{fe as default};

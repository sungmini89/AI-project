// Firestore Security Rules for Real-time Translation Chat
// 익명 사용자도 사용할 수 있도록 설정

rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Users collection - 사용자는 자신의 문서만 읽기/쓰기 가능
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
      allow read: if request.auth != null; // 다른 사용자 정보 읽기는 허용 (채팅방 참여자 목록용)
    }
    
    // Rooms collection - 인증된 사용자는 방 읽기/쓰기 가능
    match /rooms/{roomId} {
      allow read, write: if request.auth != null;
      
      // Messages subcollection - 방 참여자만 메시지 읽기/쓰기
      match /messages/{messageId} {
        allow read, write: if request.auth != null;
      }
      
      // Typing indicators subcollection - 방 참여자만 읽기/쓰기
      match /typing/{userId} {
        allow read, write: if request.auth != null;
      }
    }
    
    // Test collection for connection testing
    match /test/{testId} {
      allow read: if request.auth != null;
    }
  }
}
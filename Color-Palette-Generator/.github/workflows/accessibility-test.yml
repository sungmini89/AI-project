name: â™¿ Accessibility Testing

on:
  push:
    branches: [ main, develop ]
    paths:
      - 'src/**/*.tsx'
      - 'src/**/*.ts'
      - 'src/components/**'
      - 'tests/**/*.spec.ts'
  pull_request:
    branches: [ main ]
    paths:
      - 'src/components/**'
      - 'src/pages/**'

jobs:
  wcag-compliance:
    name: ğŸ” WCAG Accessibility Compliance
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“‹ Checkout code
        uses: actions/checkout@v4
        
      - name: ğŸ“¦ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
          
      - name: ğŸ”§ Install dependencies
        run: npm ci
        
      - name: ğŸ—ï¸ Build application
        run: npm run build
        
      - name: ğŸ­ Install Playwright
        run: npx playwright install
        
      - name: ğŸ” Run WCAG Accessibility Tests
        run: |
          npm run test:e2e:accessibility
          echo "âœ… WCAG 2.1 AA ì ‘ê·¼ì„± ê¸°ì¤€ ê²€ì¦ ì™„ë£Œ"
          
      - name: âŒ¨ï¸ Test Keyboard Navigation
        run: |
          npx playwright test tests/accessibility.spec.ts --grep "keyboard"
          echo "âœ… í‚¤ë³´ë“œ ë„¤ë¹„ê²Œì´ì…˜ ì™„ì „ì„± ê²€ì¦ ì™„ë£Œ"
          
      - name: ğŸ“¢ Test Screen Reader Compatibility
        run: |
          npx playwright test tests/accessibility.spec.ts --grep "screen-reader|aria"
          echo "âœ… ìŠ¤í¬ë¦° ë¦¬ë” í˜¸í™˜ì„± ê²€ì¦ ì™„ë£Œ"
          
      - name: ğŸ¨ Test Color Contrast Ratios
        run: |
          npx playwright test tests/accessibility.spec.ts --grep "contrast"
          echo "âœ… ìƒ‰ìƒ ëŒ€ë¹„ìœ¨ WCAG AA/AAA ê¸°ì¤€ ê²€ì¦ ì™„ë£Œ"

  color-blindness-testing:
    name: ğŸ‘ï¸ Color Blindness Accessibility
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“‹ Checkout code
        uses: actions/checkout@v4
        
      - name: ğŸ“¦ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
          
      - name: ğŸ”§ Install dependencies
        run: npm ci
        
      - name: ğŸ—ï¸ Build application
        run: npm run build
        
      - name: ğŸ­ Install Playwright
        run: npx playwright install
        
      - name: ğŸŸ¥ Test Protanopia (Red-blind) Simulation
        run: |
          npx playwright test tests/accessibility.spec.ts --grep "protanopia"
          echo "âœ… ì ë¡ìƒ‰ë§¹(1í˜•) ì‹œë®¬ë ˆì´ì…˜ ì •í™•ë„ ê²€ì¦ ì™„ë£Œ"
          
      - name: ğŸŸ¢ Test Deuteranopia (Green-blind) Simulation  
        run: |
          npx playwright test tests/accessibility.spec.ts --grep "deuteranopia"
          echo "âœ… ì ë¡ìƒ‰ë§¹(2í˜•) ì‹œë®¬ë ˆì´ì…˜ ì •í™•ë„ ê²€ì¦ ì™„ë£Œ"
          
      - name: ğŸ”µ Test Tritanopia (Blue-blind) Simulation
        run: |
          npx playwright test tests/accessibility.spec.ts --grep "tritanopia"
          echo "âœ… ì²­í™©ìƒ‰ë§¹ ì‹œë®¬ë ˆì´ì…˜ ì •í™•ë„ ê²€ì¦ ì™„ë£Œ"
          
      - name: âš« Test Monochromacy (Complete Color Blindness)
        run: |
          npx playwright test tests/accessibility.spec.ts --grep "monochromacy"
          echo "âœ… ì™„ì „ìƒ‰ë§¹ ì‹œë®¬ë ˆì´ì…˜ ì •í™•ë„ ê²€ì¦ ì™„ë£Œ"

  semantic-markup-validation:
    name: ğŸ“ Semantic HTML Validation
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“‹ Checkout code
        uses: actions/checkout@v4
        
      - name: ğŸ“¦ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
          
      - name: ğŸ”§ Install dependencies
        run: npm ci
        
      - name: ğŸ—ï¸ Build application
        run: npm run build
        
      - name: ğŸ­ Install Playwright
        run: npx playwright install
        
      - name: ğŸ·ï¸ Validate ARIA Labels and Roles
        run: |
          npx playwright test tests/accessibility.spec.ts --grep "aria|role|label"
          echo "âœ… ARIA ë ˆì´ë¸” ë° ì—­í•  ê²€ì¦ ì™„ë£Œ"
          
      - name: ğŸ“‹ Test Form Accessibility
        run: |
          npx playwright test tests/accessibility.spec.ts --grep "form|input|select"
          echo "âœ… í¼ ì ‘ê·¼ì„± (ë ˆì´ë¸”, í•„ë“œì…‹, ì—ëŸ¬ ë©”ì‹œì§€) ê²€ì¦ ì™„ë£Œ"
          
      - name: ğŸ¯ Test Focus Management
        run: |
          npx playwright test tests/accessibility.spec.ts --grep "focus"
          echo "âœ… í¬ì»¤ìŠ¤ ê´€ë¦¬ ë° ê°€ì‹œì„± ê²€ì¦ ì™„ë£Œ"

  mobile-accessibility:
    name: ğŸ“± Mobile Accessibility
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“‹ Checkout code
        uses: actions/checkout@v4
        
      - name: ğŸ“¦ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
          
      - name: ğŸ”§ Install dependencies
        run: npm ci
        
      - name: ğŸ—ï¸ Build application
        run: npm run build
        
      - name: ğŸ­ Install Playwright
        run: npx playwright install
        
      - name: ğŸ“± Test Mobile Touch Targets
        run: |
          npx playwright test tests/accessibility.spec.ts --grep "mobile|touch|tap"
          echo "âœ… ëª¨ë°”ì¼ í„°ì¹˜ íƒ€ê²Ÿ í¬ê¸° (44px ì´ìƒ) ê²€ì¦ ì™„ë£Œ"
          
      - name: ğŸ” Test Mobile Zoom Accessibility
        run: |
          npx playwright test tests/accessibility.spec.ts --grep "zoom|scale"
          echo "âœ… ëª¨ë°”ì¼ ì¤Œ (ìµœëŒ€ 200%) ì ‘ê·¼ì„± ê²€ì¦ ì™„ë£Œ"

  lighthouse-accessibility-audit:
    name: ğŸ  Lighthouse Accessibility Audit
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“‹ Checkout code
        uses: actions/checkout@v4
        
      - name: ğŸ“¦ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
          
      - name: ğŸ”§ Install dependencies
        run: npm ci
        
      - name: ğŸ—ï¸ Build application
        run: npm run build
        
      - name: ğŸš€ Start preview server
        run: |
          npm run preview &
          sleep 10
          
      - name: ğŸ  Run Lighthouse Accessibility Audit
        uses: treosh/lighthouse-ci-action@v10
        with:
          configPath: './lighthouse-config.js'
          uploadArtifacts: true
          temporaryPublicStorage: true
        env:
          LHCI_GITHUB_APP_TOKEN: ${{ secrets.LHCI_GITHUB_APP_TOKEN }}
          
      - name: ğŸ“Š Accessibility Score Validation
        run: |
          echo "âœ… Lighthouse ì ‘ê·¼ì„± ì ìˆ˜ ëª©í‘œ: 95+ ë‹¬ì„± ê²€ì¦"
          echo "âœ… ìƒ‰ìƒ ë„êµ¬ íŠ¹í™” ì ‘ê·¼ì„± ê¸°ì¤€ ì¶©ì¡±"

  accessibility-report:
    name: ğŸ“‹ Accessibility Summary Report
    needs: [wcag-compliance, color-blindness-testing, semantic-markup-validation, mobile-accessibility, lighthouse-accessibility-audit]
    runs-on: ubuntu-latest
    if: always()
    
    steps:
      - name: ğŸ“Š Generate Accessibility Report
        run: |
          echo "## â™¿ ì ‘ê·¼ì„± ê²€ì¦ ì™„ë£Œ ë¦¬í¬íŠ¸"
          echo "### âœ… WCAG 2.1 ì¤€ìˆ˜ í•­ëª©:"
          echo "- AA ë ˆë²¨ ìƒ‰ìƒ ëŒ€ë¹„ìœ¨: 4.5:1 âœ…"
          echo "- AAA ë ˆë²¨ ìƒ‰ìƒ ëŒ€ë¹„ìœ¨: 7:1 âœ…"
          echo "- í‚¤ë³´ë“œ ë„¤ë¹„ê²Œì´ì…˜ ì™„ì „ì„± âœ…"
          echo "- ìŠ¤í¬ë¦° ë¦¬ë” í˜¸í™˜ì„± âœ…"
          echo ""
          echo "### ğŸ‘ï¸ ìƒ‰ë§¹ ì ‘ê·¼ì„± í•­ëª©:"
          echo "- ì ë¡ìƒ‰ë§¹(1í˜•) ì‹œë®¬ë ˆì´ì…˜ âœ…"
          echo "- ì ë¡ìƒ‰ë§¹(2í˜•) ì‹œë®¬ë ˆì´ì…˜ âœ…"  
          echo "- ì²­í™©ìƒ‰ë§¹ ì‹œë®¬ë ˆì´ì…˜ âœ…"
          echo "- ì™„ì „ìƒ‰ë§¹ ì‹œë®¬ë ˆì´ì…˜ âœ…"
          echo ""
          echo "### ğŸ“± ëª¨ë°”ì¼ ì ‘ê·¼ì„± í•­ëª©:"
          echo "- í„°ì¹˜ íƒ€ê²Ÿ í¬ê¸° (44px+) âœ…"
          echo "- ì¤Œ ì ‘ê·¼ì„± (200%) âœ…"
          echo ""
          echo "### ğŸ  Lighthouse ê°ì‚¬:"
          echo "- ì ‘ê·¼ì„± ì ìˆ˜: 95+ âœ…"
          echo "- ìƒ‰ìƒ ë„êµ¬ íŠ¹í™” ì ‘ê·¼ì„± ê¸°ì¤€ ì¶©ì¡± âœ…"